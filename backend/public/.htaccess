# ============================================
# 3D Print Pro - Apache Configuration
# ============================================
# This file routes all requests to index.php
# for the Slim framework to handle routing.
# ============================================

<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Redirect trailing slashes if not a folder
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} (.+)/$
    RewriteRule ^ %1 [L,R=301]
    
    # Send requests to index.php if not a real file/directory
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^ index.php [QSA,L]
</IfModule>

# ============================================
# Security Headers
# ============================================

<IfModule mod_headers.c>
    # Prevent MIME type sniffing
    Header set X-Content-Type-Options "nosniff"
    
    # Enable XSS protection
    Header set X-XSS-Protection "1; mode=block"
    
    # Prevent clickjacking
    Header set X-Frame-Options "SAMEORIGIN"
    
    # HSTS (optional, enable in production with SSL)
    # Header set Strict-Transport-Security "max-age=31536000; includeSubDomains"
</IfModule>

# ============================================
# Compression
# ============================================

<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/xml
</IfModule>

# ============================================
# Caching
# ============================================

<IfModule mod_expires.c>
    ExpiresActive On
    # API responses should not be cached
    ExpiresByType application/json "access plus 0 seconds"
</IfModule>

# ============================================
# Deny Access to Sensitive Files
# ============================================

<FilesMatch "^\.">
    Order allow,deny
    Deny from all
</FilesMatch>

<FilesMatch "(composer\.json|composer\.lock|\.env)$">
    Order allow,deny
    Deny from all
</FilesMatch>
